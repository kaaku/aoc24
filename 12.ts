import { areEqual, encodePoint, getAdjacentPoints, getValue, isInsideMap, Point } from "./utils";

const INPUT = `\
WWWWWWWHHHHHHHWHRRRRRJJBBJJGDDDDDDDDDDDDDDQQFFFFFFFFKFHHHHHEEEEEHHHKHHHHHHHUUUEEEEEEEEEEVVVVVVVVVVVRRRRRRRRUUUUNVVVVVVVVVVVVNNNNNNNNNNNNNYNN
WWWWWWWWHHHHHHHHRRRRJJJJJJJJDDDDDDDDDDDDDQQFFFFFFFFFFFHFHFEEEEEEHHHHHHHHHHHEUEEEEEEEEEEEVVDVVVVVRRRRRRRRRRRRUUUVVVVVVVVVVVVNNVNNNNNNNNNNNNNN
WWWWWWWHHHHHHHHHRRRJJJJJJJJDDDDDDDDDDDDDDDQFFFFFFFFFFFFFFFEEEEEEEHHHHHHHHHHEEEEEEEEEEEEEVVDVLVVLAARRRRRRRRRRUUUAVVVVVVVVVVVVVVNNNNNNNNNNNNNN
WWWWWWHHHHHHHHHHRRRRRJJJJJDDDDDDDDDDDDDDDDDDFFFFFFFFFFFFFFEEEEEEEHHHHHHHHHHEEEEEEEEEEEEEVVDVLLLLLLRRRRRRRRRUUUUVVVVVVVVVVVVVVNNNNNNNNNNNNNNN
WWWWWWWWWHHHHHHRRRRRJJJJJIDDDDDDDDDDDDDDDTTTFFFFFFFFFFFFFEEEEEEEEEIHHHHHHHHEEEEEEEEEEDTDVDDDDLLLLLRRRRRRRROOUUUVVVVVVVVVVVVVVNNNNNNNNNNNNNNN
WWWWWWWWWHHHHHHHRRRRJJJJJGYDDJDDDDDDDDVDDTTTFFFFFFFFFFFFFCEEEEEEEEEHHHHHHHHHEEEEEEEEEDDDDDDDDLLLLLRRRRRRRROOUUVVVVVVVVVVVVVNVNNNNNNNNNNNNNNN
WWWWWWWWWWWWHHRRRRRJJJJJXGYYGDDDDDDDDDDDTTTTFTTFFFFFFFFFFFFEEEEEEEEUUHHHHHHHEMMEEEEEDDDDDDDDDLLLLRRRRRRORROOUUVVVVVVVDVVVVVVVNNNNNNNNNNNNNNN
WWWWWWWWWWWBBRRRRRRRXXJJGGGGGGDDDVDDDDDTTTTPFTTFFFFFFFFFFFFEEEPPCCCCCCUHUUHSSMMEEEDDDDDDDDDDDLLLLTTRROROOOOOOUBBVVVDDDVVVVVVNNNNNNNNNNNNNNNN
WWYYWWWWWWWBBBRRRRRRRXXJAGGGGGGGDDDDDTTTTTTPTTTTTFFFFFFFFFEEEPPPCCCCCCCCCSSSSMMEEMMMMDDDDDDDDSLTTTTSTOOOOOOOOODDHDDDDDVVVVVVVVNNNNNNNNNNNPPP
YYYYYWWWWWBBBBBRRRRXXXXGGGGGGGGGGDDDDDTTTTTTTTTRFFFFFFFFFFEEEPPPCCCCCCCCCSSSSMMMMMMMMDDDDDDDDDLTTTTTTOOOOOOOOODDDDDDDDDVVVVVKKNNNNNNNNNPPPPP
YYYYWWWYBBBBBBBRRRRXXXXGGGGGGGGGGGGDDDQQQTTTTTTRRFFRFFFFFFFEPPPPCCCCCCCCCUUMMMMMMMMMMDDDDDDDDDLTTTTTTORORROROODDDDDDDDDDVVVVKKKNKNNNPPPPPPPP
YYYYYWYYDBBBZZBRRXXXXXXXXXGGGGGGGGGDDDQQTTTTTRRRRMFRFFFFFCCCCCCCCCCCCCCCCUUMMMMMMMMLLLDDDDDDDDDDTTTUTORORRRRRDDDDDDDDDDDVVVVKKKKKKPPPPPPPPPP
YYYYYYYYYBBBBBBRRXXXXXXXXXGGGGGGGGQDDQQQQQQTTRTRRRRRRFFFKCCCCCCCCCCCCCCCCUUUMMMMMMMLLLDDDDDDDDDSNTNTTORRRRRRRDUDDDDDDDDDVVKKKKKKKKKPPPPBBPPB
YYYYYYYYYYBBBBBXXXXXXXXXXXGGGGGGQQQQQQQQQQXTTTTRRRRRRFFFZCCCCCCCCCCCCCCCCUGUMMMMMMMLLLDDDDDDDDDDNNNNNORRRRPRRLUDDDDDDDDDKKKKKKKKKKPPPPPBBBBB
YYYYYYYYYYBBBBBXXXXXXXXXXGGGGGGQQQQQQQQQQQQTTTTTRRRRRSFFZCCCCCCCCCCCCCUUUGGMMMMMMMMLLLDDDDDDDDDDNNNNROORRRRRLLLLDLDDDDDKKKKKKKKKKKPPPPWBBBBI
YYYYYYYBBBBBBBBBXXXXXXXXXXGGGGGQQQQQQQQQQTTTTLRJRRRRRRRRZCCCCCCCCCCCCCCUGGGMMMMMMMMLLLDDDDDDDLDNNNNNRORRRRRRLLLLDLHDDDDKKKKKKKKKKKKPPPWBBBBB
YYYYYYYYBBBBBBXXXXXXXXXXXXXGGGGQQQQQQQQQQQTTTTRRRRRRRRRRRCCCCCCCCCCCCCCKGGGMMYYYMMMLLLDDDDDDDDNNNNNRRRRRRRRLLLLLLLLEDDKKKKKKKKKKKKKKPPWBBBBB
YYYYYYYBBBBBBBXXXXXXXXXXXXXGGGGQQQQQQQQQQRRRTRRRRRRRRRRRRCCCCCCCCCCCCCCKGGGGGYYYYYMLLLCDDDDDNNNNNNNNRRRRLRLLLLLLLLLEDDKKKKKKKKKKKWQQWWWBBBBB
YYYYYYYBBBBBBBXXXXXXXXXXGXXGGGGQQQQQQQDQQRRTTRRRRRRRRRRRRCCCCCCCCCCUCCCKZGGGYYYYYYMLLLDDDMMMMNNNNNNNNNULLLLLLLLLLLLEEDDKKKKKKKKKWWWWWWWWWBBB
LLYYYYYYBBBBBBXXXXXXXXXXGGGGGGGQQQQQQQDQQRRRRRRRRRRRRRRRRCCCCCCCCCCUUUKKZGGYRYYYYYYLLLMMDMMMMNNNNNNNLLLLLLLLLLLUULUEEDKKKKKKKKKWWWWWWWWWBBBB
IIYYYUYIIIIIBBBXXXXXXXXXMGGGGGGGQQQQQDDRRRRRRRRRMMRRRRRRRCCCCCCCCCCCCCCCZGGYYYYYYYUMMMMMMMMMMMNNNNNNLLLLLLLLLUUUUUUEUUKKKKKKWWWWWWWWWWWWBBBB
IIIIIIIIIIBBBBBBXXXXXMXMMGGGGGGGGGGGQUDDRRRRRRRMMMMMMRRRRRRRRUZCCCCCCCCCZZGYYYYYMYUMMMMMMMMMMNNNNNNNNNLLLLUULUUUUUUUUUKKKKBBJWWWWWWWWWWWBBBB
IIIIIIIIIIIIIMMBYXMMZZZZZZZGGGGGGGGGDUDDDDDRRRRRMMMMMMRRRRRRRUZCCCCCCCCCZGGYYYYYMMMMMMMMMMMMMNNNNNNNNNLLLOUUUUUUUUUUUUKKKBBBJJWWWWWWWWHWBBBB
IIIIIIIIIIIIIMMXXXXMZZZZZZZMGGGGGGGGDDDDDDDDRRRDDMMMMMRRRRRRJZZCCCCCCCCCZZGYYYYYMMMMMMMMMMMMMMNNNNNNNNNLLUUUUUUUUUUUPPBBKKBBJWWWBWWWWWHWBBBB
IIIIIIIIIIIIIMMMMMMMZZZZZZZMGGGGGXDDDDDDDDDDDDDDDMMMMMMRRRJJJZZCCCCCCCCCZZGGGGYYMMMMMMMMMMMMMMNNNNNNNNNNNUUUUUUUUUUUPPBBBBBBBBBWBNWWWWWWZBBB
IIIIIIIIIIIIIMMMMMMMZZZZZZZMGGGGXXXDDDDDDDDDDDVDMMMMMMMRRRJJJZZCCCCCCCCCZGGGGGGGMMMMMMMMMMMMMODDNNNNNNNNNNUUUUUUUUUUUPPBBBBBBBBBBNNNNNWUBBBB
IIIIIIIIIIIIIXMMMMMMZZZZZZZMMXXXXXDDDDDDDDDDDDDDMMMMMMMRRJJJZZZZZZZZZZSSSSSGGGGGMGMMMMMMMMMMMMMDNDNNNNNNNNUUUUUUUUUUPPPPPBBBBBBBBNNNNNNUBCCC
IIIIIIIIIIIIIXMMMMMMZZZZZZZMMXXXXXXDDDDDDDDDMMMMMMMMMMMMMJJJZZZZZZZZZSSSSSSSGGSGGGGMMMMMMCMMDDDDDDNNNNNNNNUUUUUUUUUUPPPPBBBBBBNBBNNNNNNNNCCC
IIIIIIIIIIIICMMMMMMMZZZZZZZMXXXXXXXXXDDDDDDDMMMMMMMMMMMJJJJJJJZZZZZZZSSSSSSSSSSSSGGMGGMMMMMMDDDDDDDYNNNNNNAAUUUUUUUUPPPPBBBBBBNNNNNNNNNNCCCC
IIIIIIIIIIFFMMMMMMMMZZZZZZZXXXXXXXXXDDDDDDDDDDDMMMMMMMMMJJJJJJZZZZZSSSSSSSSSSSSSSGGGGMMDDDDDDDDDYDDYNNNNNNAAAUUUUUUPPPPPBBBBNNNNNNNNNNNCCCCC
IIIIIIIIIIITTTTMMTMMZZZZZZZXXXXXXXXDDDDDDDDDDDDMMMMMMMMMJJJJJJZZZZZZSSSSSSSSSSSSGGSGGDDDDDDDDDDDYYYYNNNNNAAAUUUJJJUPPPPPPPPPNNNNNNNNNNNNNCCC
IIIIIIIIITTTTTTTTTTTTTXXXXXXXXXXXXXDDDDDDDDDDDDMMMMMMMMMMJJJJJZZZZZZZSSSSSSSSSSSSSSGGDDDDDDDDDDDYYYYYNNNNYYUUUUUJPPPPPPPPPPPNNNNNNNNNNNNNCCC
IIIIIIIIINTNTTTTTTTTTTXXXXXXXXXXXXDDDDDDDDDGDMMMMMMMMMMJJJJJJJZZZZZZGSUSSSSSSSSSSSGGGDDGDDDDDDDDDDJJJNNNNYYUUUUJJJPPPJPPPPPPPNNNNNNNNNNNNNCC
IIIIIIIIINNNTTTTTTTTTTXXXXXXXXXXXXJDDDDDNDGGMMMMMMMMMMMJMMMJJZZZZZZSSSSSSSSSSSSSSSGGGDAYYDDDDDDDDQQJJJJNYYYYYUUJJJJJJJVVPPPPPNNNNNNNNNNNNNCC
IIIIIIIIINNNNTTTTTTTTXXXXXXXXXXXXXDDDDDDGGGGMMMMMMMMMMMMMMJJJJJJZJZJSSSSSSSSSSSSGGGGGGYYYYDDDDMPPJJJJJJUYYYYYUJJJJJJJJPPPPPPRRRRNNNNNNNNCNCC
IIIIIIINNNNNNNTTTTTTTXXXXXXTXXXXXXDDDDDDDGGGGGMAAMMMMMMFMJJJJJJJJJJJSSSSSSSSSSSSSGGGYYYYYRDDDVMMMQQJJJJYYYYYJJJJJJJJJJPPPPPRRRRRRNNNNDNCCCCC
IIIIIINNNNNNNTTTTTTTTTTXXXXXCXXXXXDCTTGDGGGGGGGAAMMMMMMFMJEJJJJJJJJJJJJSSSSSSSSSGGGGYYYYYYDDDMMMMQQJJJJOYYYYYJJJJJJJJJJYPPPRRRRNNNNNNDNCCCCC
IIITTINNNNNNNTTTTTTTTTTTTWWWXXXXXXCCCTGGGGGGGGGAMMMMJMWEJJEJJJJJJJJIJJJSSSSSSSSSSGGGGYYYYYAAAAMMMMMYTTTYYYYCJJJJWJJJJJJJPPPRRRRRRRRNHHHCCCCC
IIIIIINNNNNNNNTTTTTTTTTTTTTTXXEXXXCCCCCGGGGGGAAAMJMJJJEEEEEEEEJJJIIIIIJSSSSSSSGSGGGYYYYYYYAAMMMMMMMYTTTYCCCCCJJJJJJJJJJJRRRRRRRRRHHHHHHHHCCC
IIIIIIIINNNNNNNTTTTTTTTTTTRRXHXXXXPCCDGGGGGGGAAJJJJJJJJEEEEEEEEJJIIIIIIIIISSSGGGGGYYYYYYYYAMMMMMMMYYTTTTCCCCCCJJJJJJJJJJJRRRHRHRHHHHHHHHHCCC
IIIIIIIINNNNNNTTTTTTTTTTARRRAHHHXXLLLLLLLGGGAAJJJJJJJJJJEEEEEEEJIIIIIIIIIIIISGGGYYYYYYYYYMMMMMMMMMYYYCTCCCCCJJJJJJJJJJJJRRRRHHHHHHHHHHHHHCCC
IIIIIINNNNNNNNTTTTTTTTTTARRRAAHHAVLLLLLLLLJJJJJJJJJJJJJJEEEEEEEJJIIIIIIIIIIISIGGYYYYYYYYYYMMMMMMMMMYYCCCCCCCCJJJJJJJJJJJRRRRRHHHHHHHHHHHHCCC
QIIIIINNNNNNNTTTTTTTTTTTAAAAAAAAALLLLLLLLLJYLJJJJSJJJJJEEEEEEEEJIINIIIIIIIIIIIIIYYYYYYYYYYMMMMMMMMMYYYCCCCCCCCJFFFFJJJJJRRRRRKHHHHHHHHHHHCCC
IIIIIINNNNNNNNTTTTTTTTTTAAAAAAAAAALLLLLLLLLLLJSSSSSSJJJJJEEEEEEJJJJIIIIIIIIIIIIIYYYYYYYYYYYYMMMMMMMNYYCCYCECCCCFFFZJJJJRRKKKRKKKHHHHHHHHHHCC
YIYIYYNNNNNNDDQTTTQQTTAAAAAAAAAAAALLLLLLLLLLLJVSSSSSSSSJJJJJJJJJJJJIIIIIIIIIIIIIYYYYYYYYYYYMMMMMMMMYYYYCYYCCCAAFFFZZZJJRKKKKRKKKHHHHHHHHHCCC
YYYYYYYYYNNNNNQQTQQQQTAAAAAAAAULLLLLLLLLLLLXLJVSSSSSSSJJJJJJJJJJJJJNNNNIIIIIIIIYYYYYYYYYYYMMMMMMMMMMYYYYYYCCCCCCFFFFJJJRKKKKKKKKHKHHHHHHHCCC
YYYYYYYYNNKKKWQQQQQQQTAAAAAAAAULLLLLLLLLLLLLLVVSSSSSSJJJJJJJJJJJNNNNNNNNIIIIIIIYYYYYYYYYGQQQQMMMMMMMYYYYYCCCCRRCFFFFFFJRKKKKKKKKKKKKHHRCCCCC
YYYYYYYYYNKKKKQQQRRRAAAAAAAAAAAAAAALLLLLLLLLVVSSSSSSSSSJJJJJJJJJNNNNNNNNIIIIIIIIIYYYYYGGGGQQQQMMMMMYYYYYYYYCCCRRFFFFFTTKKKKKKKKUKKKKHRRCCCCC
YYYYYYYYYYKKKKKKQQRRAAAAAAAAAAAAAAALLLLLLLLLVVVSSSSSSJJJJJJJJJJJNNNNNNNNNIIIIIIIIGYGYGGGGQQQQQMMMMYYYYYYYYYCCYFRFFKKKTKKKKKKKKKKKKKKKRRRCCCC
YYYYYYYYKKKKKKKQQRRRAAAAAAAAAAAAAAALLLLLLLXLXXSSSSSSSJJJJJJJJJJJJNNNNNNINIIIIIIIIGGGGGGGQQQQQQMMMYYYYYYYYYYYYYFFFFKKKKKKKKKKKKKKKKKRKKRRRCCC
YYYYYYYYKKKKKKKKPRRRRRWAAAAAAAAAAZZLLLLLLLXXXXSSSSSSMSJJSSJJJJJJJNNNNNNIIIIIIIIIIIGGGGGGGGGGQQGYYYYYYYYYYYYYYYFFFFFKKKKKKKKKKKKKKKKRRRRRRCCC
YYYYYIIYKKKKKKKPPRRRRAAAAAAAAARRAZZLLLLLLLXXXSSSSSSSSSSSSSJSJJJJNNNNNNNNIIIIIIIIIIGGGGGGGGGGQGGYYYYVVYYYYYYYYFFFFFFFKKKKKKKKKKKKRRKRRRRRRRRC
YYIIIIIYKKKKKKKPPRRRRRAAAAARRARAAAALCCLLLLXXXXSSSSSSESSSSSSSSSJJNNNNNNNNXXIIIIIIIIIGGGGGGGGGGGYYYYVVVVYVVYYYYKKKKKKKKKKSKKKKKKKKRRKRRRRRRCCC
IIIIIIIIIIIIKYRPRRRRRRAARARRRRRARACCCCLLLLXXXXSSTSSSSSSSSSSSSJJJJNNNNXXXXXXIIIIIIIIGGGGGGGGWWWWWWYVVVVVVVYKKKKKKKKKKKKKSKKKSSKSKRRRRRRRRRCCP
IIIIMIIIIIIIIRRRRRRRRRRRRRRRRRRRRGCCCGGLLLXXXXXTTSSSSSSSSSSSSJJJNNNNXXXXJJJJIIIIIIIGGGGGGGGWWWWWWYVVVVVVVVKKKKKKKKKKKKKSKKSSSSSSSRRRRRRRRCCP
IIIMMMIIIIIIRRRRRRRRRRRRRRRRRRRGGGCCCGGRRRQXQQXTSSSSSSSSSSSSSOOJJNXXXXXJJJJJIIIIIGGGGGGGGGGWWWWWWYVVVVVVVUKKKKKKKKKKKKKSKKSSSUSSRRRRRRRRRRPP
MMMMMMIIIIIIIIIRIRRRRRRRRRRRRRRGGGGGGGGRRQQQQYQQSSSSSSSSSSSSOOOCOOXXXXXXXJJJJIIIIIGGGGGGGGWWWWWWWQVVVVVVVVKKKKKKKKKKKKKSSSSSSSSRRRRRRRRRPPPP
MJJMMMMMIIIIIIIIIIIGRRRRRRRRRGGGGGGGGQRRQQQQQQQQQQSSSSSSSSOOOOOOOOXXXXXJJJJJAIIIIIIGGGGGGGGWWWWWWQVVVVVVVUKKKKKKKKKKKKKKKKKKSSRRRRRRRRRPPPPP
MMMMMMMMIIIIIIIIIIIGGRRRRRRRGGGGGGGGGQQQQQQQQQQQQQQSSSSSSSOOOOOOOOOXXXXJJJJJAIIIIIIIIVVVGGVWWWWWWVVVVVVVVVVZZKKKKKKKKKKKKKKKSSSRRRRRRRPPPPPP
UUUUMMMMIIIIIIIIIIGGGGGGGRRRGGGGGGGGGQQQQQQQQQQQQQSSSSSSSSOOOOOOOOXXXXXXJXXJAIIIIIAAIIVVVVVWWWWWWVVVVVVVVVVZZKKKKKKKKKKKKKKKDDSSDDRPRRPPPPPP
UUUMMMMMMMIIIIIIIIGGGGGGRRRGGGGGGGGGQQQQQQQQQQQQQQSSSSSSSSOOOOOOOXXXXXXXXXXXXRRIIIAAIIVVVVVWWWWWWVVVVVVVVVVZZKKKKKKKKKKKKKKKDDDPPDPPPPPPPPPP
UUUMMMMMMMMMIIIIIIIGRRGRRGRRGGGGGGGQQEQQQQQQQQQQQQQSSSSSSSOOOOOOOOOXXXXXXXXXXRAAAIAAVVVVVVVWWWWWWVVVVVVVVVVZZZZZZGKKKKKKKKKKDDDPPPPPPPPPPPPP
UUUMMMMMMMMMMMMIIIIGGGGGGGGGGGGGGGGQQGSQQQQQQQQQQQQSSSSSSSOOOOOOOOXXXXXXXXXXPAAAAAAAAVVVVVVWWWWWWVVVVVVVVVVZZZZGZZKKKKKKKKKKDDDDPPPPPPPPPPPP
UUUMVAMMMMMMMMMIIIIGGGGGGGGGGGGGGGGGGGQQQQQQQQQQQQQQQSSSSOOOOOOOOOOXXXXXXTXXPAAAAAAAVVAVVVVVVVVVVVVVVVVVVVVZZZGGGGKKKKKKKKKKDDPDPPPPPPPPPPPQ
UUUVVAMMMVVVMMMIIGGGGGGGGGGGGGGGGGGGGGGWQQQQQQQQQQQQQSSSSOOOOOOOOOVXXXUUTTTXPAAAAAAAAAAVVVVVVVVVVVVVVVVVVVVVGGGGGGKKKKKKKKKKDDPPPPPPPPPPPPPP
UUUVVAVMVVVVVMAAGGGGGGGGGGGGGGGGGGGGGGGWWWQQQQQQQQQQQSSSSOMOOOOOOOOOOXUUUUTTAAAAAAAAAAVVVVVVVVVVVVVVHVVVVVVVFGGGGGKKKKKKKKKKZDDPPPPPPPPPPPPV
UUUVVVVVVVVVVAAKKGGGGGGGGGGGGGGGGGGGGGGGWQQQQQQQQQQQQSSSSMMMMOMMOOOOXXXXUUUTAAAAAAAAAAAVVVVVVVVVVVCHHHHHHUUUHGGGGGGZZZZZZZZZZDPPPPVPPPPPVVPV
UUUUVVVVVVVVVVKKKKKTGGGGGGGGGMGGGGGGGGGQQQQQQQQBQQQIQSSSMMMMMMMMMMMOXXUUUUUUUAAAAAAAAAAAVVVVVVVVGHHHHHHHHUHHHHGGGGGZZZNZZZZZZZVVVVVPPPVPVVVV
UUVVVVVVVVVVKKKKKKKGGGGGGGGGGGGBBBBBGGQQQQQQQQQQQIIIQSIIMMMIMMMMMUUUUUUUUUUUSSSAAAAAAAAAWWVXVVVVGHHHHHHHHHHHHHGGGZZZZZZZZZZZZZZVVVVVPPVVVVVV
UUVVVVVVVVVVKKKKKKKKRGGGGGGGGBBBBBBBGGQQQQQQQQQQQIIIIIIIIIIIIMMMUUUUUUUUUUUUSSSSAAAAAAAAWVVVVVVLHHHHHHHHHHHHHGGGAZZZZZZZZZZZZZZVVVVVVVVVVVVV
MUUMVVMOOVVWWWKKKKKKRRGGGGGGGGBBBBBBBGQQQQQQQQQQQQIIIIIIIIIIMMMMUUUUUUUUUUUUUSSSSSAAAAAJVVVVVVLLHHHHHHHHHHHHGGGZZZZZZZZZZZZZZAAVVVVVVVVVVVVV
MUMMMMMMMMVWWKKKKKKKKGGBBBGGBBBBBBBQQQQQQQQQQQQQQQIIIIIIIIIMMMMMMUUUUUUUUUUUSSSSSSSAAAJJJVVLLLLLHHHHHHHHHHGGGGGZZZZZZZZZZZZUAAAAVVAVAAVVVVVV
MMMMMMMMMWWWWWKKXKKKUUGZBBBBBBBBBBBBBBBEQQQQQQQQQQQIIIIIIIIMMMMUUUUUUUUUUUUSSSSSSSSSSFFFFTVLLLLLLLZHXZHCHHHHGGGGGZZZZZZZZZZZAAAAAAAAAAVVVVVV
MMMMMMMMMMMWWWKXXXUUUUXZZBBBBBBBBBBBBBBBQQQQQQQQQQQIIBIIIIIMMMMUMUUUUUUUUUUSSSSSSSSSSFFFTTFFLLLLZLZZZZZCHGGHGGGGGGZZZZZZZZZAYYAAAAAAAAAVVVVV
MMMMMMMMMMMWWWXXXUUUXXXZZBBBBBBBBBBBBBBBQQQQQQBBBQBIIBIIMMMMMMMMMUUUUUUUUUUSSSSSSSFFFFFFFFFLLLLZZZZZZZZZZGGGGGGGGGZZZZZZZZAAYAAAAAAAMAVVVVVV
MZZZZZZZZMMMWWXXXUXXXXXBBBBBBBBBBBBBBBBBBBQQQQQQBBBIBBBMMMMMMMMMUUUUUUUUUUUUUSSSSLGFFFFFLLLLLLLLZZZZZZZZLGGGGGGGGGGZZZZZZZAAAAAAAAAAAAVAVVVV
AZZZZZZZZFFFXXXXXXXXXXXXBBBBBBBBBBBBBBBBBBBBEEBBBBBBBBMMMMMMMMMMUUUUUUUUUUUUUSHSSLLLFFFFFLLLLLLZZZZZZZZZLGQQGGGGGGGZZZZZZAAAAAAAAAAAAAAAAVVV
AZZZZZZZZZZZZXXXXXXXXXXXBBBBBBBBBBBBBBBBBBSEEEEEBBBBBBBMMBBMMMMMMUUUUUUUUUUUUUHHHSLLFPPFLLLLLLLZZZZZZZZZZQQGGGGGSSZZZGZZGAAAAAAAAAAAAAAAXVVV
AZZZZZZZZZZZZFFXXXXXXXXXBBBXBBXXXBBXXBBBXXEEEEEEEBBBBBGMBBBMMMMMUUUUUUUUTUUUUTHHHSLLPPPFLLLLLLZZZZZZZNNNNNNNNNNSSSZGZGGGGAGGGGAAAAAAAAAAAVVV
AZZZZZZZZZZZZXXXXXXXXXXXBBXXXBXXXXXXXBBXXAEEEEEEEBBBGGGGGBBMMBMMUUUUUUUUUUUUHHHHHHLLLLLFLLLUUUMZUZZZZNNNNNNNNNNSSSGGGGGGGGGGGGAAAAAAAAAAJJVV
AZZZZZZZZZZZZSSXXXXXXXXXXXXXXXXXXXXXXXXXAAEEEEEEEEBGGGGGGGBMBBMMGGGUUXUUUUUUHHHHLLLLLLLLLLUUUUUUUUHHZNNNNNNNNNNSGGGGGGGGGGGGGGAAAAAAAAAAAVVV
AZZZZZZZZZZZZSSHHHHXXXXXXGGGGXXGGXXXXXAAAAEEEEEEBBBGGGGGGGBBBBBMMMUUUUUUUWWUHPPHWLLLLLLLLLUUUUUUUUHHZNNNNNNNNNNSGGGGGGGGGGGGGGAAAAAAAAALVVVV
AZZZZZZZZZZZZSSHIHHHHHHHXXGGGGGGGGXXXXAAAAAEEEEEEGGGGGGGGGGBBBBBBUUUUUUUUWWUHHHHWWLLLLLLUUUUUUUUUUHHZNNNNNNNNNNYYGGGGGGGGGGGGGAYAAAAGAALVVVV
AZZZZZZZZZZZZZZZZHHHHHHXXGGGGGGGXXXXXAAAAAAEEEEEEGGGGGGGGCBBCBBBBBBUUUUUUTWWWHWWWWLLLLLLRUUUUUUUHHHHZNNNNNNNNNNYYYYGGGGGGGGGGGQYAAAAGALLVVVL
AZZZZZZZZZZZZZZZZIHHHHHGGGGGGGGGXGGXGAAAAAAAEKEEEGGGGGGGYCBBCCCBBBBUUUUUUTWWWWWXXWLLLLLLNNNNNNNNNNNNNNNNNNNNNNNYYXXXGGBBGGGGGGQQGGAAGAALLLLL
AZZZZZZZZZZZZZZZZZZZZZZZZGGGGGGGGGGGGAAAAAAAAAMMMMMGGGGGCCCCCCBBBBBAAAUUUTWWTWWWXXXOOOOVNNNNNNNNNNNNNNNNNNNNNNNYYXXXXXQBGGGGGGQAAGGGGGGLLLLL
AZZZZZZZZZZZZZZZZZZZZZZZZGGGGGGGGGGGGAAAAAAAAMMMGGGGGGCCCCCCCCBBBBBBBAUUUTWTTWXWXXVOOOOONNNNNNNNNNNNNNNNNNNNNNNNNXXXXXQGGQQGGQQAAGGGGAGGLLLL
AZZZZZZZZZZIIIIZZZZZZZZZZGGGGGGRRGGKGAAAAAAAAMMMGMGGTGVVCCCCCCCCBAAAAAAUUTTTTTXXXOVVOOOOOHUUUUHNNNNNNNNNNNNNNNNNNXXXXXQQQQQQGQAAAGGGGAGGLLLL
AZZZZZZZZZZIIIIZZZZZZZZZZGGGGGGRBBRKGAAAAAAAAAMMMMTTTGVVCCCCCCCCBBBAAAAUUTTTTTTXXOOOOOOOOOKUUUHNNNNNNNNNNNNNNNNNNXXXQQQQQQQQQQAAAGGGAALLLLLL
AAAAAAAACIIIIIIZZZZZZZZZZGGEGRRRRRRRAAAAAAAAAAMMMMMMTGGGCCCCCCCCBBBAAAATTTTTTTTTTOOOOOOOOKKKUPPPPHPHHHHHNNNNNNNNNXXQQQQQQQQQQQQAAAAAAAALLLLL
AAAAAAAAAQQIIIIZZZZZZZZZZGGEEERRRRRAAAAAAAAMMMMMMTMTTTTTCCCCCCCCCCBAAAAQQTTTTTTTOCOOOOOOOKKKPPPPPPPHHPHHNNNNNNNNNNNNQQQQQQQQQQQQQQAAAAAAAALL
AAAAAAAAAQQIIIIZZZZZZZZZZEEEEEERRMMAMMAAAPAMMMMMMTTTTTTTCCCCCCCCAAAAAAQQQTTTTTTTOOOOOOOOOKKPPPPPPPPPPPPLNNNNNNNNNNNNQQQQQQQQQQQQQQAAAAAAAAAA
AAAAAAAAAQQIIIIZZZZZZZZZZEEEEEERRMMMMMAAAAMMMMMTTTTTTTTTGCCCCCCCAIIAAATTTTTTTTTTOOOOOOOOOOOHPPPPPPPPPPPPPPNNNNNNNNNNQQQQQQQQQQQAQAAAAAAAAAAA
AAAAAAAQQQQQQIIZZZZZZZZZZEEEEEEEEMMMMMMAMMMMMMTTTTTTTTTTTTDDTIIIIIIAARTTTTTTTTTTOOOOOOOOOHHHPPPPPPPPPPPPPPXXXBBBBEBBGBBQBQBQQQQAQAAAAAAAAAAA
EAAGASSPQQQQQQIZZZZZZZZZZEEEEEEMMMMMDMMMMDMMMMMTTTTTTTTTTTTTTTIIIIAAARTTTTTTTTOOOOOOOOOOHHHPPPXPPPPPPXXXXXXXBBBBBBBBBBBBBBBQQQQAAAAAAAAAAAAA
EAAGPPSPPPPQQQQQQQEEEQQEEEEEEEEEMMDMDMMDDDDMMMMTTTTTTTTTTTTTTIIIIIIAITTTIITTTLLOOOOOOOOOYYYMMMPPPPPPPXXXXXXBBBBBBBBBBBBBBBBQQQQAAAAAAAAAAAAA
EPAPPPPPPPPPQQUQQQEEEEEEEEEEEEEMMMDDDDDDDDDMMMTTTTTTTTTTTTTTIIIIIIIIIIIIIITTTTLLOOLLYYOYYYYYYPPPPPPMPXXXXXXBBBBBBBBBBBBBBBQQQQQKAACCAAAXAAAA
PPSPPPPPPPPAUUUQQQEEEEEEEEEEEEEMMMMDDDDDDDDDTTTTHTTTTTTTTTTTIIPIIIIIIIIILIIILLLLLJLLLYYYYYYYPPNNPPPMXXXXXXXBBBBBBBBBBBBBBPPQQQQAACCCAAAAAAAA
PPPPPPPPPPPPUUUQEEETTEEEEEEEEEMMMMDDDDDDDDDDTUEPTTTTTTTTTTTTIIPPIPIPIIIILLILLLLLLLLLLLYYYYYYYPPPPPPXXXXXXXBBBBBBBBBBBBBBBBBQQQCCCCCCAACAAKKU
PPPPPPPPPUPUUUEEDEETTTEEEEEEEEMMMMMDDDDDDDDDNEEEKTTTTTTTTTTPPPPPPPPPIIIILLLLLLLLLLLLLLYYYYYYYMZPPZZZXXXXXXBBPPPBBBBBBBBBBNNPPPCCCCCCACCCKKKU
PPPPPPPPUUPUUEEEEEEEEEMEENXXEEMXMDDDDDDDDDDDDDEKKJTTTTWTTTTPPPPIIIIIIIIIIILLLLLLLLLLLLYYYYYQQYZZPZZZZZZXXXPPPPPPBBBBBBBBBNNNPPPPCCCCCCCCCCCC
PPPPPPPPPUUUUEEEEEEEEEEEEXXXXXXXXDDDDDDDDDDDDEEEJJVTTWWTTTPPPPPPPIIIIIIIIILLLLLLLLLLLLYYYYYYYYYZPZZZZZZZXZEPPEEPBBBBBNBBNNNNPPPPPPPCCCCCCCCC
PPPPPPPPUUUEEEEEEEEEEEEAAXXXXXXXXXDDDDDDDDDDDEEELJJJJWWTWTYYPPPPIIIIIIIIIQLLLKKLLLLLLLYYYYYYYYYZZZZZZZZZZZEEEEEEEBBNNNNNNNNNPPPPPPPCCCCCCCCC
PPPPPPPUUUUUUEEEEEEEEEEAAXXXXXXXMMDDDDDDDDDDDEEEJJJJWWWWWPPPHPPPPPIIIIIQQQQKKKKLLLYYYYYYYYYYYYYYZZZZZZZZZEEEEEEEEEBNFFNPPPPPPPPPPPPPPCCCCCCC
PPPPPPUUUUUUUEEEEEEEEEAAAXXXXXXXXXDDDDDDDDDDDEEEJJJJJJWWWPPPPPPPPPPPIIIIQQQQKKKKLEYYYYYYYYYYZZZZZZZZZZZZZZZZGEEEEAFFFFNPPPPPPPPPPPPPPPPCCCCC
PPPPPPJJUUUUUUUEEEEEEAAAAXXXXXXXXXBDDDDDDDDDEEJJJJJJWWWWWPPPPPPPPPPPPIIQQKQQKKKKBBYYYYYYYYFFZZZZRZZZZZZZZZZZZEEEFFFFFNNNPPPPPPPPPPPPPPPCCCCR
PPPPPRJJJJJUUUUEEEEEEEAAXXXXXXXXXXBDDDDIDDDEEEJJJEJJWWWWWPPPPPPPPPPPIIIIQKKQKBKKBBYYFFYYYYFZZZZZRRZZZZZZZHZZZHEFFFFFFFFPPPPPPPPPPPPPPPCCCCCR
KKPPPRRRJCCUUUUUEEEEEEAAXXXXXXXXXXXXDDDKWDDDEEJJJEJJWWWWWWWPPPPPFPPPPIDDKKKKKBBBBBYYYFYYYFFFZZZZZRZZZZZZZHZHHHHFFFFFFFFFPPPPPPJPPPPPPPPCCCRR
KKPPPGGGJJCUUUUUEEEEEEAXXXXXXKKKXXXXKJKKKEEEEEJJEEJJWWFWWWPPWPPPPPPPPIDDKKBBKBBBBBFFYFYYFFFFZZZZZRZZZYZHHHHHHHFFFFFFFFFFEQPPPPCPPPCPPCCCRCRR
KKPPGGGGJJCUUUUUEEUUUUXXXXXBBKOKKKKKKKKKEEEEEEEEEEFKFFFFWWPPWPPPPPPWDDDDKKBBBBBBBBFFFFYFFFFFZZOZZRZZZYHHYYHHHHCCCFFFFZFEEQQCCCCPCCCPCCCCRRRR
GGGGGGGGCCCCUUUUUEUUUUUUUUXBBKKKKKKKKKKKEEEEEEEEEEFFFFFFWWPWWPPPPPPWDDDKKKKBBBBBBBFFFFFFFFFFFZOZZHZZYYHYYYYYHHCCCCFFFOOEEQQQQQCCCCCCCCCCRFRR
NGGGGGGGCCCCOUUUUUUUUUUUUUXBBKKKKKKKKKKKEEEEEEEEEFFFFFFFWWWWWPWPPWWWDDDKKKKBBBBBBBBFBFFFFFFFFFHHHHYYYYYYYYYYCCCCCCCCOOOEQQQQQQCCCCCCCCFFFFFR
NGGGGGGGCCCCOOUUUUUUUUUUUBBBBBKKKKKKKKKKEEEEEEEEEFFFFFFWWWWWWWWPWWDDDDDDDKBBBBBBBBBBBBBFFFFFFFHHHHYYYYYYYYYYYCCCCCOOOOQQQQQQQQCCCCCCCFFBFFFF
GGGGGGGCCCOOOOOOUUUUUUUUUBBBBKKKKKKKKKKRKEEEEEEFFFFFFFFFFWWWWWWWWWWDDDDDKKBJBBBBBBBBBBFFFFFFFFFHHHYYYYYYYYYCCCCOOOOOOOQQQQQQQQQCCCCCFFFFFFFF
GGGGGGGCCCCOOOOOUUUUUUUUBBBBBKKKKKKKKKKKKEEEEEEFFFFFFFFFFWWWWWZZWTTDDDDDDKBBBBBBBBBBFFFFFFFFFFFFHHHYYOOOYYYCCCCCOOOOOQQQQQQQQGGCCCCCFFFFFFFF
GGGGGGGGGCCOOOOOOOOOUBUUUBBBBBBKKKKKKKKKKEEEEFFFFFFFFFFFFZZZZZZZTTTTDDDDBBBBBBBBBBBFFFFFFFFFFFFHHHHHHHHHCCCCCOOOOOOOOQQQQQQQQGCCCCCCFFFFFFFF
ZGIGGIJGCCCOOOOOOOOOBBUBBBBOBBKKKKKKKKKKKEEEEEFFFFFFFFFFFZZZZZZZTTTTDTDWWBWBBBBBBBFFFFFFFFFFFFFSFHHHHHHHHDCCCOOOOOOOOQQQFFQQQQACCCCCCPPFFFFP
IIIIIIIICCOOOOOOOOOOBBBBOBOOOKKKKKKKKKKKKEEEEEFFFFFFFFFFZZZZZZZTTTTTTTWWWWWBBFBBBBFFFFFFFFFFFFFFFHHHHHHBHCCCAAAOOOOOOOOOQQQQQQCCCCCCCCPPPPPP
IIIIIIICCCOOOOOOOOOOOBBIOBBOOOOXKKKKKKKKKKEEEFFFFFFFFFFKZZZZZZZPPPTTTTTWWWWWBFBBBBFFFFFFFFFFFFFHHHHHHHHHHCCCCCOOOOOOOOOOOQQQQACCCCCSCCPPPPPP
IIIIIIICCCOOOOOOOIOIIBIIOOOOOOOXKKKKKKKKKKEEEFFFFBBFFFFFZZZZZZZZPPTPTPTWWWWWFFFFBFJJFFFFFFFFFFFHHHHHHHHHHHCWWMOOOOOOOOOOOQQAAACCCYCCCPPPPPPP
IIIIIIICCCCOOOOOIIIIIIIIIOOOOOOOKKKKKKKKKKEEEFFFFFBBBFBZTZZZZZZJPPPPPPPWWWFWFFFFFFFFFFFFFFFFFFFFFFHHHHXHHWWWMMMOOOOOOOOOOOCACACCCYCCPPPPPPPP
IIIIIIIICCOOOOOIIIIIIIIIIOOOOOOKKMKKHKHKKKKKEFEZFFBBBFBZZZZZZZZPPPPPPPPPPWFFFFFFFFFFFFFFFFFFFFFFFFHHHXXXXWWMMMMMOOOOOOOOOOCCCCCCCCCPPPPPPPPP
IIIIIIICCCCOOIIIIIIIIIIIIOOOOOOOOHHHHHHHHHHHEEEBBBBBBBBZZZQQZQQPPPPPPPPPPWSFFFFFFFFFFFFFFFFFFFFFPHHHHHXWWWWWWQMMMOOOOOOORRCCCCCCCCCPPPPPPPPP
IIIIICCCCCCCIIIIIIIIIIIIIIOOOOOOHHHHHHHHHHHHHEEBBBUUUUUUQQQQZQPPPPPPPPPPSWSFFFFFFFFFHFFFFFFFFFFFPHHHHXXWWWWYQQQQMOOOOOOYCCCCCCCCCCCCCPPPPPPP
IIIIIIIICCCCIIIIIIIIIIIIIIOOOOOOHHHHHHHHHHHQQQBBBBUUUUUUQQSQQQPPPPPPPPPPSSSFFFFFFFFFFFPPFPPFPPFFPPPPWWWWWYYYQQBQMOOOOOOOOPPCCCCCCCCCCCCCCPCC
IQIIIIIICCCCCIIIIIIIIIIIIOOOOOOHHHHHHHHHHHRQQQQBBBUUUUUUSSSSSSAPPPPPPPPPSSJFFFFFFFFFFFPPPPPPPPPPPPPPPPWPPPYYYQQYYLOOOOOOPPPPCCCCCCCCCCCCCCCC
QQIIIIICCCCCCCIIIIIIIIIIIICOOOOHHHHHHHHRRRRQQQQBBBUUUUUUSSSSSSPPPPPPPPSPSSJFSPPPFFFFFFPPPPPPPPPPPPPPPPPPPPPYYYYYYLPPPPPOPPPPCCCECCCCCCCCCCCC
IIIIICCCCCCCCCIIIIIIIIIIIICCOOHHHHHHHHHRRRRQQQQBBBUUUUUUSSSSSSSPSSPPPSSSSSSSSCPPFFFFFFPPPPPPPPPPPPPPPPPPPPYYYYYYUYPPPPPPPPPPPPEEECCCCCCCOOCC
IIIICCCCRRRRRRIIIIIIICCCIICCOOOHQQHHHHHHRRRRRRRBBBUUUUUUUUUSSSSSSSSSPSSSSSSSHHGPFFFFFFPPPJPPPPPJPPPPPPPYYYYYYYYYYYHPPPPPPPPPPEEEEEECCCOOOOOV
CICCCCCRRRRRRRIIMIIIIICCCCCCCOQHQQQHHRHRRRRRRRBBBBBBUUUUUUUSSSSSSSSSSSSSSSSHHHFFFFFFFFPJPJPJJJJJJPPPPPPYYYYYYYYYNPPPPPPPPPPEEEEEEEECOCOOOOOO
CICCCCCRRRCRRIRIMMIIVVCCCCCCCOQQQQQHHRRRRRRRRRNBBBBUUUUUUUUSSSSSSSSSSSSSSSSHHHHFFFFFFFJJPJJJJJJJJPPPTTTTYYYYYYYYYPPFPPPPPPPPPEEEEEEEOOOOOOOO
CCCCRRRRRRRRRRRRRMIVVCCCCICJCQQQQQQRRRRRRRRRRRNRBBBUUUUUUUUUUUUUUSSSSSSSSSSHHHHFFFFFMMJJPJJJJJJJPPPPTTTTYYYYYYYYYFFFFPPPPPPPPEETEEEOOOOOOOOO
CCCCRRRRRRRRRRRRRRVVVCCCCQQQQQQQQQQQRRRRRRRRRRNRRBBUUUUUUUUUUUUUUSSSSSSSSHHHHHHFFFFFMMJJJJJJJJJJPPTTTTTTTZYYYYYYYFFFPPQPPPPPPEOOOOOOOOOOOOOO
CCCCRRRRRRRRRRRRRRRVVVVVQQQQQQQQQQQQRRRRRRRRRRRRCCCBCUUUUUUUUUUUUSSSSSSSSHHHHHHFFFFMMMJJJJJJJJJJJPTTTTTTTZYQYFYYFFFFPQQQQQQPPOOOOOOOOOOOOOOO
CCCCRRRRRRRRRRRRRRVVVVVVQVQQQQQQQQQQQRRRRRRRRRRRCCCCCCUUUUUUUUUUUSSSSSSSHHHHHHHHHFFJJJJJJJJJJJJJTTTTTTTTTTTTFFFFFFFFQQQQQQPPPOOOOOOOOOOOOOOO
CCCCRRRRRRRRRRRRRRVRVVVVQQQQQQQQQQQQQRRRRRRRRRRRRCCCCCUUUUUUUUUUUSCTTCSHHHHHHHHHHFUJJJJJJJJJJJJJTWTTTTTTTTFFFFFFFQQQQQQQPIPPPDOOOOOOOOOOOOOO
CCCCCCRRRRRRRRRRRRRRVVVVQQQQQQQQQQQQQRRRRRRRRRRRRRCCCCCCUUUUUUUUUCCCTCHHHHHHHHHHHFUUJVJJJJWJJJJJFTTTTFTTTTFFFFFFFQQQQQQPPPPPPDOZOOKOOOOOOOOO
CCCCCCRRRRCRRRRRRVRVVVVVVVQQQQQQQQQQQRRRRRRRRRRRRRRRCCCCUUUUUUUUUCCCCCHHHHHHHHHHHFUUJJJJJJJJJJJJFFFFFFTTTFFFFFFFFFQFQQFPPPPKKKZZZZOOOOOOOOOO
CCCCCRRCCRCCRRRRRVVVVVVVVVVVQQQQQQQQQRRRRRRRRRRRRRRCCCCCUUUUUUUUUCCCOOHHHWWHHHUUUUUUJUUUUUJJJJJJFFFFFFTTFFFFFFFFFFQFFQFFKKKKKKKZZOOHHOOOOOOO
CCCCCCCCCCCCRWWRRVVVVVVVVVVVQQQQQQQQQRRRRRRRRRRRRRCCCCCCUUUUUUUUUCCCOHHHHWHHHHHUUUUUUUUUUUUJJUJJJFFFFFFFFFFFFFFFFFFFFFFFKQKKKKZZZZZOOOFOOOOO\
`;

interface Region {
    perimeter: number;
    plant: string;
    tiles: Point[];
}

function countPerimeter(tile: Point, map: string[][]) {
    return 4 - getAdjacentPoints(tile)
        .filter(adjacent => isInsideMap(adjacent, map) && getValue(adjacent, map) === getValue(tile, map))
        .length;
}

function getNeighborTilesWithSamePlant(tile: Point, map: string[][], ignoredTiles: Point[]) {
    return getAdjacentPoints(tile)
        .filter(adjacent => isInsideMap(adjacent, map) &&
            getValue(adjacent, map) === getValue(tile, map) &&
            !ignoredTiles.some(ignored => areEqual(adjacent, ignored)));
}

function findRegionTiles(startTile: Point, map: string[][]) {
    const regionTiles = [startTile]
    let neighbors = getNeighborTilesWithSamePlant(startTile, map, regionTiles);
    while (neighbors.length > 0) {
        regionTiles.push(...neighbors);
        neighbors = Object.values(neighbors
            .flatMap(neighbor => getNeighborTilesWithSamePlant(neighbor, map, regionTiles))
            .reduce((acc, tile) => ({ ...acc, [encodePoint(tile)]: tile }), {}));
    }

    return regionTiles;
}

const MAP = INPUT.split('\n').map(row => row.split(''));

const regions: Region[] = [];
const processedTiles = new Set<string>();

MAP.forEach((row, y) => row.forEach((plant, x) => {
    const tile = { x, y };
    if (!processedTiles.has(encodePoint(tile))) {
        const tiles = findRegionTiles(tile, MAP);
        const perimeter = tiles.reduce((sum, _tile) => sum + countPerimeter(_tile, MAP), 0);
        regions.push({ perimeter, plant, tiles });
        tiles.map(encodePoint).forEach(encoded => processedTiles.add(encoded));
    }
}));

const fencePrice = regions.reduce((price, { perimeter, tiles }) => price + perimeter * tiles.length, 0);

console.log('Fence price:', fencePrice);
